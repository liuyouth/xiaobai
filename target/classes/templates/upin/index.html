<!DOCTYPE html>
<html>

<head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>小白杂货铺 | 优品 </title>

    <link href="../css/bootstrap.min.css" rel="stylesheet">
    <link href="../font-awesome/css/font-awesome.css" rel="stylesheet">

    <link href="../css/plugins/dataTables/datatables.min.css" rel="stylesheet">
    <link href="../css/plugins/datapicker/datepicker3.css" rel="stylesheet">

    <link href="../css/animate.css" rel="stylesheet">
    <link href="../css/style.css" rel="stylesheet">

</head>

<body>

<div id="wrapper">

    <nav class="navbar-default navbar-static-side" role="navigation">
        <div class="sidebar-collapse">
            <ul class="nav metismenu" id="side-menu">
                <li class="nav-header">
                    <div class="dropdown profile-element" style="    text-align: center;"> <span>
                            <svg t="1509728315144" class="icon" style="width: 4em; height: 4em;vertical-align: middle;fill: #ff6767;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="998"><path d="M512.064 937.6c-197.184 0-357.568-148.032-357.568-329.856l0-430.528c0-49.408 40.192-89.6 89.664-89.6C244.352 87.552 246.4 87.488 249.024 87.36c9.792-0.576 18.944-1.024 23.104-1.024 203.584 0 369.216 165.696 369.216 369.344 0 102.464-40.96 197.696-115.328 268.096l-1.728 1.6c-6.848 6.528-17.6 6.528-24.576 0C425.344 655.872 382.656 557.504 382.656 455.68c0-70.336 19.904-138.752 57.408-197.824 5.312-8.448 16.448-10.88 24.832-5.568S475.776 268.736 470.464 277.12c-33.92 53.312-51.84 115.072-51.84 178.56 0 86.208 33.792 169.6 93.376 231.488 60.352-62.4 93.44-144 93.44-231.488 0-183.808-149.568-333.312-333.312-333.312-3.648 0-15.168 0.576-21.312 0.896C247.232 123.392 244.544 123.456 244.096 123.456c-29.632 0-53.76 24.128-53.76 53.76l0.064 430.528c0 162.112 144.256 294.016 321.6 294.016 177.344 0 321.6-131.904 321.6-294.016L833.6 177.216c0-29.632-24.064-53.76-53.696-53.76-0.512 0-3.072-0.064-6.656-0.256-6.208-0.32-17.792-0.896-21.312-0.896-54.208 0-105.856 12.544-153.536 37.376C589.568 164.288 578.752 160.832 574.208 152.064 569.6 143.296 573.056 132.416 581.824 127.872c52.16-27.136 110.976-41.472 170.176-41.472 4.096 0 13.312 0.448 23.104 1.024 2.624 0.128 4.544 0.192 5.248 0.256 49.088 0 89.28 40.192 89.28 89.6l0 430.528C869.632 789.632 709.248 937.6 512.064 937.6" p-id="999"></path></svg>
                             </span>
                        <a data-toggle="dropdown" class="dropdown-toggle" href="#">
                            <span class="clear"> <span class="block m-t-xs"> <strong
                                    class="font-bold">优品</strong>
                             </span> <span class="text-muted text-xs block"> 尽享好物 ∞ <b
                                    class="caret"></b></span> </span> </a>
                        <ul class="dropdown-menu animated fadeInRight m-t-xs">
                            <!--<li><a href="profile.html">Profile</a></li>-->
                            <!--<li><a href="contacts.html">Contacts</a></li>-->
                            <!--<li><a href="mailbox.html">Mailbox</a></li>-->
                            <!--<li class="divider"></li>-->
                            <!--<li><a href="login.html">Logout</a></li>-->
                        </ul>
                    </div>
                    <div class="logo-element">
                      U 品
                    </div>
                </li>

                <li class="active">
                    <a href="/upin/admin"><i class="fa fa-diamond"></i> <span class="nav-label"> 优 品 汇 </span></a>

                </li>
            </ul>

        </div>
    </nav>

    <div id="page-wrapper" class="gray-bg">
        <div class="row border-bottom">
            <nav class="navbar navbar-static-top" role="navigation" style="margin-bottom: 0">
                <div class="navbar-header">
                    <a class="navbar-minimalize minimalize-styl-2 btn btn-primary " href="#"><i class="fa fa-bars"></i>
                    </a>
                    <form role="search" class="navbar-form-custom" action="#" >
                        <div class="form-group">
                            <input type="text" placeholder="" class="form-control"
                                   name="top-search" id="top-search">
                        </div>
                    </form>
                </div>
                <ul class="nav navbar-top-links navbar-right">
                    <li>
                        <span class="m-r-sm text-muted welcome-message"> 欢迎来到小白杂货铺 </span>
                    </li>
                    <li class="dropdown">
                        <a class="dropdown-toggle count-info" data-toggle="dropdown" href="#">
                            <i class="fa fa-envelope"></i> <span class="label label-warning">0</span>
                        </a>

                    </li>
                    <li class="dropdown">
                        <a class="dropdown-toggle count-info" data-toggle="dropdown" href="#">
                            <i class="fa fa-bell"></i> <span class="label label-primary">0</span>
                        </a>

                    </li>


                    <!--<li>-->
                    <!--<a href="login.html">-->
                    <!--<i class="fa fa-sign-out"></i> Log out-->
                    <!--</a>-->
                    <!--</li>-->
                </ul>

            </nav>
        </div>
        <div class="row wrapper border-bottom white-bg page-heading">
            <div class="col-lg-10">
                <h2>优品汇聚 ，尽享好物 （ 好的资源共享出来，节省你我的购物时间 = 省钱 ）</h2>
                <span style="color: #bdbdbd;font-weight: 300;">发布 or 寻找你喜欢的商品（衣物，数码，食物 包含但不限于以上几类）</span>
                <ol class="breadcrumb">
                    <li>
                        <a href="#">Home</a>
                    </li>
                    <li class="active">
                        <strong>Upin</strong>
                    </li>
                </ol>
            </div>
            <div class="col-lg-2">

            </div>
        </div>
        <div class="wrapper wrapper-content animated fadeInRight">
            <div class="row">
                <div class="col-lg-12">
                    <div class="ibox float-e-margins">
                        <div class="ibox-title">
                            <h5>精选商品</h5>
                            <div class="ibox-tools">
                                <a class="collapse-link">
                                    <i class="fa fa-chevron-up"></i>
                                </a>
                                <a class="collapse-link " data-id="addUpinView">
                                    <i class="fa fa-chevron-down">添加</i>
                                </a>
                                <a class="dropdown-toggle" data-toggle="dropdown" href="#">
                                    <i class="fa fa-wrench"></i>
                                </a>
                                <ul class="dropdown-menu dropdown-user">
                                    <li><a href="#">Config option 1</a>
                                    </li>
                                    <li><a href="#">Config option 2</a>
                                    </li>
                                </ul>
                                <a class="close-link">
                                    <i class="fa fa-times"></i>
                                </a>
                            </div>
                        </div>
                        <div class="ibox-content">

                            <div class="ibox float-e-margins " data-id="addUpinView">
                                <div class="ibox-content" style="display: none;">
                                    <form id="upinForm" class="form-horizontal">
                                        <p> // 选择参数类型填写对应的参数值 </p>

                                            <div class="input-group left">

                                                <input type="text" name="title"  placeholder="title..."
                                                       class="form-control"/>
                                            </div>


                                            <div class="input-group left">

                                                <input type="text" name="name"  placeholder="发布者的名字..."
                                                       class="form-control"/>
                                            </div>



                                            <div class="input-group left">

                                                <input type="text" name="info"  placeholder="分享文案（包含网址）..."
                                                       class="form-control"/>
                                            </div>


                                            <div class="input-group left">

                                                <input type="hidden" name="typeId" id="typeAutoHide"  placeholder="typeId..."
                                                       class="form-control"/>
                                                <input type="text" id="typeAuto" placeholder="种类...单选"
                                                           class=" typeahead_3 form-control"/>
                                                <span class="input-group-btn">
                                                        <button type="button" id="addUpin"
                                                                class="btn btn-primary">添加！</button>
                                                    </span>
                                            </div>







                                        <div class="clear"></div>

                                    </form>
                                </div>
                            </div>
                            <div id="upinList" class="list">

                            </div>

                        </div>
                    </div>
                </div>
                <div class="col-lg-3">
                </div>
            </div>
        </div>
        <div class="footer">
            <div class="pull-right">
                10GB of <strong>250GB</strong> Free.
            </div>
            <div>
                <strong>Copyright</strong> 小白 Company &copy; 2014-2017
            </div>
        </div>

    </div>
</div>


<!-- Mainly scripts -->
<script src="../js/jquery-3.1.1.min.js"></script>
<script src="../js/bootstrap.min.js"></script>
<script src="../js/plugins/metisMenu/jquery.metisMenu.js"></script>
<script src="../js/plugins/slimscroll/jquery.slimscroll.min.js"></script>

<script src="../js/plugins/dataTables/datatables.min.js"></script>

<!--  Custom and plugin javascript  -->
<script src="../js/inspinia.js"></script>
<script src="../js/plugins/pace/pace.min.js"></script>
<!-- Typehead -->
<script src="../js/plugins/typehead/bootstrap3-typeahead.min.js"></script>
<!-- Data picker -->
<script src="../js/plugins/datapicker/bootstrap-datepicker.js"></script>
<!-- Clipboard -->
<script src="../js/plugins/clipboard/clipboard.min.js"></script>
<!-- 点赞 -->
<script src="http://cdn.jsdelivr.net/mojs/latest/mo.min.js"></script>

<!-- Page-Level Scripts -->
<script>
    var upin;
    $(document).ready(function () {




        $('#data_1 .input-group.date').datepicker({
            todayBtn: "linked",
            keyboardNavigation: false,
            forceParse: false,
            calendarWeeks: true,
            autoclose: true
        });
        loadData();

        model = $('.dataTables-upin').DataTable({
            select: true,
            ajax: {
                "url": '/upin/list'
            },
            columns: [


                    {
                        data: "id",
                        "title": "ID",
                        defaultContent: "无"
                        , width: "50px"
                    },

                    {
                        data: "title",
                        "title": "标题",
                    },

                    {
                        data: "img",
                        "title": "图片",
                    },

                    {
                        data: "name",
                        "title": "发布者",
                    },

                    {
                        data: "info",
                        "title": "分享文案",
                        width: "200px"
                    },

                    {
                        data: "type.typeName",
                        "title": "种类",

                    },
                {
                    data: null,
                    title: "操作",
                    render: function (data, row) {
                        return '<a target="_blank" href="'+data.url+'"><button class="btn btn-sm btn-white" href="">去购买</button></a>';
                    }
                },


            ],
            pageLength: 25,
            responsive: true
//            fnDrawCallback: function( settings ) {
//                $('button.icobutton').each(function(icon){
//                    var el3 = icon, el3span = el3.querySelector('span');
//                    new Animocon(el3, {
//                        tweens : [
//                            // burst animation
//                            new mojs.Burst({
//                                parent: el3,
//                                duration: 1500,
//                                delay: 300,
//                                shape : 'circle',
//                                fill : [ '#988ADE', '#DE8AA0', '#8AAEDE', '#8ADEAD', '#DEC58A', '#8AD1DE' ],
//                                x: '50%',
//                                y: '50%',
//                                opacity: 0.6,
//                                radius: {40:90},
//                                count: 6,
//                                isRunLess: true,
//                                easing: mojs.easing.bezier(0.1, 1, 0.3, 1)
//                            }),
//                            // ring animation
//                            new mojs.Transit({
//                                parent: el3,
//                                duration: 750,
//                                type: 'circle',
//                                radius: {0: 50},
//                                fill: 'transparent',
//                                stroke: '#988ADE',
//                                strokeWidth: {35:0},
//                                opacity: 0.6,
//                                x: '50%',
//                                y: '50%',
//                                isRunLess: true,
//                                easing: mojs.easing.bezier(0, 1, 0.5, 1)
//                            }),
//                            // icon scale animation
//                            new mojs.Tween({
//                                duration : 1100,
//                                onUpdate: function(progress) {
//                                    if(progress > 0.3) {
//                                        var elasticOutProgress = mojs.easing.elastic.out(1.43*progress-0.43);
//                                        el3span.style.WebkitTransform = el3span.style.transform = 'scale3d(' + elasticOutProgress + ',' + elasticOutProgress + ',1)';
//                                    }
//                                    else {
//                                        el3span.style.WebkitTransform = el3span.style.transform = 'scale3d(0,0,1)';
//                                    }
//                                }
//                            })
//                        ],
//                        onCheck : function() {
//                            el3.style.color = '#988ADE';
//                        },
//                        onUnCheck : function() {
//                            el3.style.color = '#C0C1C3';
//                        }
//                    });
//                })

//            }
        });

        $('#typeAuto').typeahead({
            source: function (query, process) {
                return $.ajax({
                    url: '/upin/type/list',
                    type: 'get',
                    data: {name: query, parameter: "4"},
                    success: function (result) {
                        var resultList = result.data.map(function (item) {
                            var aItem = {id: item.upinTypeId, name: item.typeName};
                            return JSON.stringify(aItem);
                        });
                        return process(resultList);
                    }
                });
            }
            , showHintOnFocus: true,
            afterSelect: function (data) {
                console.log(data)
            }, updater: function (obj) {
                var item = JSON.parse(obj);
                $('#typeAutoHide').attr('value', item.id);
                return item.name;
            }, highlighter: function (obj) {
                if (obj != "{}") {
                    var item = JSON.parse(obj);
                    var query = this.query.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g, '\\$&')
                    return item.name.replace(new RegExp('(' + query + ')', 'ig'), function ($1, match) {
                        return '<strong>' + match + '</strong>'
                    })
                }
            }, items: "all",
        });
    });

    $('#addUpin').on('click', function () {
        console.log($('#upinForm').serialize());
        $.ajax({
            type: "post",
            url: "/upin/add",
            data: $('#upinForm').serialize(),
            success: function (data) {
                if (data.message == "SUCCESS") {
                    model.ajax.reload();
                }
            },error: function (data) {
                alert(dara.message);
            }
        });
    });
   function loadData(){
       $.ajax({
          type:"get",
           url:"/upin/list",
           success:function (data) {

                   model.ajax.reload();
                   var div = "";
                   for (var i=0;i<data.data.length;i++)
                   {
                        dat = data.data[i];



                       div+= '<div class="col-lg-3 col-xs-10 col-md-6 col-sm-6 box"><div class=" item "> <img style="width: 100%;" src="'+dat.img+'">  <div ' +
                           'class="title"> <div style="height:40px;">' +
                           '<span>'+dat.title+'</span></div>' +
                           '<div><span>分享者:'+dat.name+'</span>' +
                           '<button class="btn btn-info" style="float: right;margin:3px" onclick="praise('+dat.id+')"><svg t="1511083804667" class="icon" style="width: 1.4em; height: 1.4em;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="18343"><path d="M230.967761 971.143429H27.445895c-4.433568 0-8.233768-3.800201-8.233769-8.233768v-524.427713c0-4.433568 3.800201-8.233768 8.233769-8.233768h203.521866c4.433568 0 8.233768 3.800201 8.233768 8.233768v524.427713c0 4.433568-3.589079 8.233768-8.233768 8.233768z" fill="#3C92CA" p-id="18344"></path><path d="M600.853973 43.049942c-59.536479-43.702309-141.874164-18.57876-145.25212-17.523149-8.022646 2.533467-13.300703 9.922747-13.300703 18.156515v181.142906c0 61.43658-29.134873 113.372658-86.771252 154.5415-44.546798 31.879462-90.149208 44.969043-90.571452 45.180165-0.422245 0-0.633367 0.211122-1.055612 0.422244l-10.767235 3.589079c-6.333668-10.344991-17.523148-17.312026-30.612729-17.312026H35.679663c-19.634371 0-35.679663 16.045292-35.679663 35.679663v507.749053c0 19.634371 16.045292 35.679663 35.679663 35.679663h187.054329c16.889781 0 31.034973-11.822847 34.624052-27.445894 25.12355 26.812528 60.803213 43.702309 100.494199 43.702309h442.934517c94.160531 0 154.330377-49.191488 164.886491-135.118251l56.580768-359.330099c8.233768-52.1472-13.089581-104.927767-54.469545-134.484885-23.434572-16.889781-51.091589-25.756917-80.015339-25.756916H657.434741v-168.053325c0-65.870147-19.001004-113.161535-56.580768-140.818552z m-380.86457 908.881361H38.21313v-502.470997h181.776273v502.470997z m667.779732-561.796354c20.901104 0 40.746598 6.333668 57.636379 18.57876 29.557117 21.323349 44.969043 59.536479 38.846497 97.538487l-56.369646 359.541222v0.633366c-10.344991 84.026662-74.737283 101.760933-127.095605 101.760933H357.852243c-54.89179 0-99.438588-44.546798-99.438588-99.438588v-401.554552l17.523149-5.911424c6.122546-1.688978 53.202811-16.045292 100.916443-50.035977 67.770248-48.135877 103.661033-112.528169 103.661034-186.20984v-165.942102c21.956716-4.222445 66.08127-8.444891 97.960732 14.989681 27.02365 19.845493 40.746598 56.79189 40.746597 109.783579v187.265451c0 10.556113 8.656013 19.212126 19.212127 19.212126h249.335398v-0.211122z" fill="" p-id="18345"></path></svg>' +
                           '<span id="praise'+dat.id+'">'+dat.praiseNum+'</span></button><button class="btn  btn-info" style="float: right;margin:3px" data-clipboard-text="'+dat.info+'">' +
                           '<i class="fa fa-copy" />淘口令</button>' +
                           '<a target="_blank" href="'+dat.url+'" ><button class="btn  btn-info" style="float: right;margin:3px"><svg t="1511083350132" class="icon" style="width: 1.4em; height: 1.4em; vertical-align: middle; fill: currentcolor; overflow: hidden; " viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="6863"><path d="M691.775456 630.795617 468.110397 630.795617c-14.128789 0-25.582655-11.452843-25.582655-25.582655s11.453866-25.582655 25.582655-25.582655l223.665059 0c10.559497 0 19.151176-8.591679 19.151176-19.151176l0-313.131697c0-10.559497-8.591679-19.150152-19.151176-19.150152L110.245893 228.197282c-10.559497 0-19.150152 8.590656-19.150152 19.150152l0 313.131697c0 10.559497 8.590656 19.151176 19.150152 19.151176 14.128789 0 25.582655 11.452843 25.582655 25.582655s-11.453866 25.582655-25.582655 25.582655c-38.772049 0-70.315462-31.543414-70.315462-70.316485l0-313.131697c0-38.772049 31.543414-70.315462 70.315462-70.315462l581.530586 0c38.773072 0 70.316485 31.543414 70.316485 70.315462l0 313.131697C762.091942 599.252203 730.548528 630.795617 691.775456 630.795617z" p-id="6864" fill="#cdcdcd"></path><path d="M915.441539 854.460676 333.911976 854.460676c-38.772049 0-70.315462-31.543414-70.315462-70.316485L263.596514 471.013517c0-38.772049 31.543414-70.315462 70.315462-70.315462l223.665059 0c14.129812 0 25.582655 11.453866 25.582655 25.582655s-11.452843 25.582655-25.582655 25.582655L333.911976 451.863365c-10.559497 0-19.150152 8.591679-19.150152 19.150152l0 313.130673c0 10.559497 8.590656 19.151176 19.150152 19.151176l581.529563 0c10.559497 0 19.151176-8.591679 19.151176-19.151176L934.592714 471.013517c0-10.559497-8.591679-19.150152-19.151176-19.150152-14.129812 0-25.582655-11.453866-25.582655-25.582655s11.452843-25.582655 25.582655-25.582655c38.773072 0 70.316485 31.543414 70.316485 70.315462l0 313.130673C985.758024 822.917262 954.213587 854.460676 915.441539 854.460676z" p-id="6865" fill="#fff"></path></svg>' +
                           '</a></button></div></div></div></div>';
                   }
                   $("#upinList").append(div);
                    initClip();
           }
       });
   }

   function initClip(){
       var clipboard = new Clipboard('.btn');
       clipboard.on('success', function(e) {
           console.info('Action:', e.action);
           console.info('Text:', e.text);
           console.info('Trigger:', e.trigger);

           e.clearSelection();
       });

       clipboard.on('error', function(e) {
           console.error('Action:', e.action);
           console.error('Trigger:', e.trigger);
       });
   }
   function praise(id) {
       $.ajax({
           type: "post",
           url: "/upin/praise",
           data: {"id":id},
           success: function (data) {
               if (data.message == "SUCCESS") {
                   var jid = 'praise'+data.data.id;
                    $("#"+jid+"").text(data.data.praiseNum);

               }else{
                   alert("点赞失败");
               }
           }, error: function (data) {
               alert(dara.message);
           }
       });
   }
</script>

</body>

</html>
